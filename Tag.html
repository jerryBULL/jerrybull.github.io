<!DOCTYPE html>
<html lang="zh-Hant-TW">
    <head>
        <meta charset="UTF-8" />
        <title>Jerry的學習筆記-Tag</title>
        <meta name="description" content="學習筆記的標籤"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="icon" href="/Content/img/favicon.ico" type="image/x-icon">
        <!-- jquery-confirm start -->
        <link rel="stylesheet" href="/Content/css/lib/jquery-confirm/bundled.css" />
        <link rel="stylesheet" href="/Content/css/lib/jquery-confirm/jquery-confirm.min.css" />
        <!-- jquery-confirm end -->
        <link rel="stylesheet" href="/Content/css/common.css" />
        <link rel="stylesheet" href="/Content/css/style.css" />

        <script src="/Content/js/lib/vue.js"></script>
        <script src="/Content/js/lib/httpVueLoader.js"></script>
        <script src="/Content/js/lib/jquery-3.5.1.min.js"></script>
        <script src="/Content/js/lib/jquery-confirm/jquery-confirm.min.js"></script>
        <script src="/Content/js/function.js"></script>
        <script src="/Content/js/ArticleList/ArticleList.js"></script>
        <script src="/Content/js/ArticleList/ArticleTag.js"></script>
        <script src="/Content/js/ArticleList/ArticleCategory.js"></script>
        <script src="/Content/js/ArticleList/ArticleFuntion.js"></script>

        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-J1KMGN3SP6"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'G-J1KMGN3SP6');
        </script>
    </head>
    <body>
        <header></header>
        <div class="body" v-cloak>
            <div class="content list_content">
                <div class="article" v-if="PageArticle.length == 0">
                    <a class="article__title">小弟還在努力學習中</a>
                    <hr class="article__line">
                    <a class="article__img-box" style="background-image: url(/Content/img/nothing.jpg)"></a>
                </div>
                <div class="article" v-for="article in PageArticle[CurrentPage]">
                    <a :href="article.article_route" class="article__title">{{ article.title }}</a>
                    <hr class="article__line">
                    <div class="article__info">
                        <span class="article__info-time">{{ article.create_time }}</span>
                        <ul class="article__info-tag">
                            <li v-for="tag in article.tag">
                                <a @Click="ShowTagArticle(tag)">{{ ArticleTag[tag] }}</a>
                            </li>
                        </ul>
                    </div>
                    <a class="article__img-box" :href="article.article_route" :style="{ 'background-image': 'url(' + article.img_route + ')' }">
                        <div class="article__img-content-box">
                            <div class="article__img-content flex-center">
                                <div class="img-content_content" v-html="article.img_content"></div>
                                <hr>
                                <div class="img-content_create-time">
                                    {{ article.create_time }}
                                </div>
                            </div>
                        </div>
                        <p class="article__img-place-name" v-if="article.img_place_name != 'none' && article.img_place_name != ''">{{ article.img_place_name }}</p>
                    </a>
                </div>
                <div class="page-box">
                    <ul class="page-box__ul">
                        <li><span @click="ChangePage(1)"class="fa fa-angle-double-left"></span></li>
                        <li>
                            <span @click="PrevPage" class="fa fa-angle-left"></span>
                        </li>
                        <li v-for="page in TotalPage" v-if="((page < 4 && CurrentPage < 3) || TotalPage == 3)">
                            <span @click="ChangePage(page)" :class="[CurrentPage == page ? 'active' : '']">{{ page }}</span>
                        </li>
                        <li v-for="page in TotalPage" v-if="(page > CurrentPage-2 && page < CurrentPage+2 && CurrentPage > 2 && CurrentPage < TotalPage-1 && TotalPage > 3)">
                            <span @click="ChangePage(page)" :class="[CurrentPage == page ? 'active' : '']">{{ page }}</span>
                        </li>
                        <li v-for="page in TotalPage" v-if="(CurrentPage > TotalPage-2 && page > TotalPage-3 && TotalPage > 3)">
                            <span @click="ChangePage(page)" :class="[CurrentPage == page ? 'active' : '']">{{ page }}</span>
                        </li>
                        <li>
                            <span @click="NextPage" class="fa fa-angle-right"></span>
                        </li>
                        <li><span @click="ChangePage(TotalPage)" class="fa fa-angle-double-right"></span></li>
                    </ul>
                </div>
            </div>
            <sidebar-component :article_tag="ArticleTag" :article="Article" :article_tag="ArticleTag"><sidebar-component>
        </div>
        <footer></footer>

        <script>
            $(function(){
                $("header").load("View/header.html");
                $("footer").load("View/footer.html");

                let body = new Vue({
                    el:".body",
                    components: {
                        'sidebar-component': httpVueLoader('/View/vue_component/sidebar.vue')
                    },
                    data:function(){
                        return{
                            PageArticle:[],
                            TotalPage:1,
                            CurrentPage:1,
                            //
                            ArticleTag:ArticleTag,
                            Article:Article
                        }
                    },
                    mounted(){
                        var tag = GetURLParames("tag");
                        this.ShowTagArticleList(tag);
                    },
                    methods: {
                        ShowTagArticleList(tag){
                            var v_this   = this;
                            var articles = ArticleFuntion.FilterArticleTag(tag);

                            var page_article = [];
                            var page_count   = 5;
                            var page         = 0;
                            articles.forEach((article,key) => {
                                if((key)%page_count != 0){
                                    page_article[page].push(articles[key]);
                                }else{
                                    page++;
                                    page_article[page] = [];
                                    page_article[page].push(articles[key]);
                                }
                            });
                            v_this.PageArticle = page_article;
                            v_this.TotalPage   = page == 0 ? 1 : page;
                        },
                        ShowTagArticle(tag){
                            location.href = "/Tag.html?tag=" + tag;
                        },
                        ChangePage(page){
                            var v_this = this;
                            if(v_this.CurrentPage != page){
                                v_this.CurrentPage = page;
                            }
                        },
                        PrevPage(){
                            var v_this = this;
                            if(v_this.CurrentPage == 1){
                                return false;
                            }
                            v_this.CurrentPage--;
                        },
                        NextPage(){
                            var v_this = this;
                            if(v_this.CurrentPage == v_this.TotalPage){
                                return false;
                            }
                            v_this.CurrentPage++;
                        },
                    }
                })
            })
        </script>
    </body>
</html>