<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Jerry的學習筆記</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="icon" href="/Content/img/favicon.ico" type="image/x-icon">
        <!-- jquery-confirm start -->
        <link rel="stylesheet" href="/Content/css/lib/jquery-confirm/bundled.css" />
        <link rel="stylesheet" href="/Content/css/lib/jquery-confirm/jquery-confirm.min.css" />
        <!-- jquery-confirm end -->
        <!-- jquery-ui start -->
        <link rel="stylesheet" href="/Content/css/lib/jquery-ui/jquery-ui.structure.min.css" />
        <link rel="stylesheet" href="/Content/css/lib/jquery-ui/jquery-ui.theme.min.css" />
        <!-- jquery-ui end -->
        <link rel="stylesheet" href="/Content/css/common.css" />
        <link rel="stylesheet" href="/Content/css/style.css" />

        <script src="/Content/js/lib/vue.js"></script>
        <script src="/Content/js/lib/jquery-3.5.1.min.js"></script>
        <script src="/Content/js/lib/jquery-confirm/jquery-confirm.min.js"></script>
        <script src="/Content/js/lib/jquery-ui/jquery-ui.min.js"></script>
        <script src="/Content/js/Function.js"></script>
        <script src="/Content/js/ArticleList/ArticleList.js"></script>
        <script src="/Content/js/ArticleList/ArticleTag.js"></script>
        <script src="/Content/js/ArticleList/ArticleFuntion.js"></script>
    </head>
    <body>
        <header>
            <div class="header__title">
                <a href="" class="header__title-heading1">Jerry的學習筆記</a>
                <p class="header__title-heading2">每天都比前一天進步一點點</p>
            </div>
            <div class="header__nav">
                <ul>
                    <li><a href="">Home</a></li>
                    <li><a href="">Article</a></li>
                    <li><a href="">About</a></li>
                </ul>
            </div>
        </header>
        <div class="body">
            <div class="content">
                <div class="article" v-if="PageArticle.length == 0">
                    <a @click="GetPages" class="article__title">小弟還在努力學習中</a>
                    <hr class="article__line">
                    <a @click="GetPages">
                        <img src="/Content/img/nothing.jpg" class="article__img">
                    </a>
                </div>
                <div class="article" v-for="article in PageArticle[CurrentPage]">
                    <a :href="article.article_route" class="article__title">{{ article.title }}</a>
                    <hr class="article__line">
                    <div class="article__info">
                        <span class="article__info-time">{{ article.create_time }}</span>
                        <ul class="article__info-tag">
                            <li>
                                <a v-for="tag in article.tag" @Click="ShowTagArticle(tag)">{{ ArticleTag[tag] }}</a>
                            </li>
                        </ul>
                    </div>
                    <a :href="article.article_route">
                        <img :src="article.img_route" class="article__img">
                    </a>
                </div>
                <div class="page-box">
                    <ul class="page-box__ul">
                        <li><span @click="ChangePage(1)"class="fa fa-angle-double-left"></span></li>
                        <li>
                            <span @click="PrevPage" class="fa fa-angle-left"></span>
                        </li>
                        <li v-for="page in TotalPage" v-if="((page < 4 && CurrentPage < 3) || TotalPage == 3)">
                            <span @click="ChangePage(page)" :class="[CurrentPage == page ? 'active' : '']">{{ page }}</span>
                        </li>
                        <li v-for="page in TotalPage" v-if="(page > CurrentPage-2 && page < CurrentPage+2 && CurrentPage > 2 && CurrentPage < TotalPage-1 && TotalPage > 3)">
                            <span @click="ChangePage(page)" :class="[CurrentPage == page ? 'active' : '']">{{ page }}</span>
                        </li>
                        <li v-for="page in TotalPage" v-if="(CurrentPage > TotalPage-2 && page > TotalPage-3 && TotalPage > 3)">
                            <span @click="ChangePage(page)" :class="[CurrentPage == page ? 'active' : '']">{{ page }}</span>
                        </li>
                        <li>
                            <span @click="NextPage" class="fa fa-angle-right"></span>
                        </li>
                        <li><span @click="ChangePage(TotalPage)" class="fa fa-angle-double-right"></span></li>
                    </ul>
                </div>
            </div>
            <div class="sidebar">
                <div class="sidebar-box">
                    <p class="sidebar-box__title">最新文章</p>
                    <hr class="sidebar-box__line">
                    <ul>
                        <li v-for="article in LatestArticle">
                            <a :href="article.article_route" class="sidebar-box__article-title">{{ article.title }}</a>
                        </li>
                    </ul>
                </div>
                <div class="sidebar-box">
                    <p class="sidebar-box__title">標籤</p>
                    <hr class="sidebar-box__line">
                    <a class="sidebar-box__tag" v-for="(val,key) in ArticleTag" @Click="ShowTagArticle(key)">{{ val }}</a>
                </div>
            </div>
        </div>
        <footer>
            <p>© 2021<a href="">Jerry的學習筆記</a></p>
            <ul class="footer-ul">
                <li>
                    <a href=""><span class="fa fa-github"></span></a>
                </li>
            </ul>
        </footer>
        <span class="rocket-icon icon rocket--js"></span>

        <script>
            $(function(){
                let body = new Vue({
                    el:".body",
                    data:function(){
                        return{
                            PageArticle:[],
                            TotalPage:1,
                            CurrentPage:1,
                            LatestArticle:[],
                            //
                            ArticleTag:ArticleTag,
                            Article:Article
                        }
                    },
                    mounted(){
                        this.GetPages(true);
                        this.GetLatestArticle();
                    },
                    methods: {
                        ChangePage(page){
                            var v_this = this;
                            if(v_this.CurrentPage != page){
                                v_this.CurrentPage = page;
                                $(".rocket--js").click();
                            }
                        },
                        PrevPage(){
                            var v_this = this;
                            if(v_this.CurrentPage == 1){
                                return false;
                            }
                            v_this.CurrentPage--;
                            $(".rocket--js").click();
                        },
                        NextPage(){
                            var v_this = this;
                            if(v_this.CurrentPage == v_this.TotalPage){
                                return false;
                            }
                            v_this.CurrentPage++;
                            $(".rocket--js").click();
                        },
                        ShowTagArticle(tag){
                            var v_this   = this;
                            var articles = ArticleFuntion.FilterArticleTag(tag);

                            var page_article = [];
                            var page_count   = 5;
                            var page         = 0;
                            articles.forEach((article,key) => {
                                if((key)%page_count != 0){
                                    page_article[page].push(articles[key]);
                                }else{
                                    page++;
                                    page_article[page] = [];
                                    page_article[page].push(articles[key]);
                                }
                            });
                            $(".rocket--js").click();
                            v_this.PageArticle = page_article;
                            v_this.TotalPage   = page == 0 ? 1 : page;
                        },
                        GetPages(is_first_load = false){
                            var v_this   = this;
                            var articles = v_this.Article;

                            var page_article = [];
                            var page_count   = 5;
                            var page         = 0;
                            articles.forEach((article,key) => {
                                if((key)%page_count != 0){
                                    page_article[page].push(articles[key]);
                                }else{
                                    page++;
                                    page_article[page] = [];
                                    page_article[page].push(articles[key]);
                                }
                            });
                            if(!is_first_load){
                                $(".rocket--js").click();
                            }
                            v_this.PageArticle = page_article;
                            v_this.TotalPage   = page == 0 ? 1 : page;
                        },
                        GetLatestArticle(){
                            var v_this   = this;
                            var articles = v_this.Article;
                            //最新文章
                            var latest_article = articles;
                            for (let i = 0; i < latest_article.length; i++) {
                                for (let j = 0; j < latest_article.length-1; j++) {
                                    if(latest_article[j]["create_time"] < latest_article[j+1]["create_time"]) {
                                        let temp = latest_article[j]
                                        latest_article[j] = latest_article[j+1];
                                        latest_article[j+1] = temp;
                                    }
                                }
                            }
                            latest_article.splice(5,latest_article.length-5);
                            v_this.LatestArticle = latest_article;
                        },
                    }
                })
            })
        </script>
    </body>
</html>